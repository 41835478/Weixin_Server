<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.whayer.wx.gift.dao.GiftDao">

	<sql id="giftFields">
		id,
		name,
		detail,
		deadline,
		img_src,
		create_time
	</sql>

	<select id="getGiftList" resultType="Gift">
		select
		<include refid="giftFields" />,
		1 as is_effect
		from sk_gift
		<trim prefix="WHERE" prefixOverrides="AND|OR">
    		<if test="isExpired != null and isExpired = 1"> 
    			 deadline >= now()
    		</if>
		</trim>
	</select>
	
	<select id="findById" parameterType="String" resultType="Gift">
		select
		<include refid="giftFields" />
		from sk_gift
		where id=#{id}
	</select>
	
	<insert id="save" parameterType="Gift">
		<![CDATA[
    		INSERT INTO sk_gift(
				id,
				name,
				detail,
				deadline,
				img_src,
				create_time
				)
			VALUES(
				#{id},
				#{name},
				#{detail},
				#{deadline},
				#{imgSrc},
				now()
			)
    	]]>
	</insert>
	
	<update id="update" parameterType="Gift">
		UPDATE sk_gift 
		    <trim prefix="SET" suffixOverrides=",">
			    <if test="name != null and name != ''">
			      name = #{name},
			    </if>
			    <if test="detail != null and detail != ''">
			      detail = #{detail},
			    </if>
			    <if test="deadline != null">
			      deadline = #{deadline},
			    </if>
			    <if test="imgSrc != null and imgSrc != ''">
			      img_src = #{imgSrc},
			    </if>
		    </trim>
			<where>
		      id=#{id}
		    </where>
	</update>
	
	<delete id="deleteById" parameterType="String">
		<![CDATA[
   			DELETE FROM sk_gift WHERE id=#{id}
   		]]>
	</delete>
</mapper>